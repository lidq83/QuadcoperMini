/*
 * task.c
 *
 *  Created on: December 23, 2019
 *      Author: lidq
 */

#include <debug_task.h>

static const float sin_table[315] = //
	{
		//
		0.000, 0.020, 0.040, 0.060, 0.080, 0.100, 0.120, 0.140, 0.159, 0.179, 0.199, 0.218, 0.238, 0.257, 0.276,				//
		0.296, 0.315, 0.333, 0.352, 0.371, 0.389, 0.408, 0.426, 0.444, 0.462, 0.479, 0.497, 0.514, 0.531, 0.548,				//
		0.565, 0.581, 0.597, 0.613, 0.629, 0.644, 0.659, 0.674, 0.689, 0.703, 0.717, 0.731, 0.745, 0.758, 0.771,				//
		0.783, 0.796, 0.808, 0.819, 0.830, 0.841, 0.852, 0.862, 0.872, 0.882, 0.891, 0.900, 0.909, 0.917, 0.925,				//
		0.932, 0.939, 0.946, 0.952, 0.958, 0.964, 0.969, 0.973, 0.978, 0.982, 0.985, 0.989, 0.991, 0.994, 0.996,				//
		0.997, 0.999, 1.000, 1.000, 1.000, 1.000, 0.999, 0.998, 0.996, 0.994, 0.992, 0.989, 0.986, 0.982, 0.978,				//
		0.974, 0.969, 0.964, 0.958, 0.953, 0.946, 0.940, 0.933, 0.925, 0.917, 0.909, 0.901, 0.892, 0.883, 0.873,				//
		0.863, 0.853, 0.842, 0.831, 0.820, 0.808, 0.797, 0.784, 0.772, 0.759, 0.746, 0.732, 0.718, 0.704, 0.690,				//
		0.675, 0.661, 0.645, 0.630, 0.614, 0.598, 0.582, 0.566, 0.549, 0.533, 0.516, 0.498, 0.481, 0.463, 0.445,				//
		0.427, 0.409, 0.391, 0.372, 0.354, 0.335, 0.316, 0.297, 0.278, 0.259, 0.239, 0.220, 0.200, 0.181, 0.161,				//
		0.141, 0.121, 0.101, 0.082, 0.062, 0.042, 0.022, 0.002,																	//
		-0.018, -0.038, -0.058, -0.078, -0.098, -0.118, -0.138, -0.158, -0.177, -0.197, -0.217, -0.236, -0.256, -0.275, -0.294, //
		-0.313, -0.332, -0.351, -0.369, -0.388, -0.406, -0.424, -0.443, -0.460, -0.478, -0.495, -0.513, -0.530, -0.547, -0.563, //
		-0.580, -0.596, -0.612, -0.628, -0.643, -0.658, -0.673, -0.688, -0.702, -0.716, -0.730, -0.744, -0.757, -0.770, -0.782, //
		-0.795, -0.807, -0.818, -0.830, -0.841, -0.851, -0.862, -0.872, -0.881, -0.890, -0.899, -0.908, -0.916, -0.924, -0.931, //
		-0.939, -0.945, -0.952, -0.958, -0.963, -0.968, -0.973, -0.978, -0.982, -0.985, -0.988, -0.991, -0.994, -0.996, -0.997, //
		-0.999, -0.999, -1.000, -1.000, -1.000, -0.999, -0.998, -0.996, -0.994, -0.992, -0.989, -0.986, -0.982, -0.979, -0.974, //
		-0.970, -0.964, -0.959, -0.953, -0.947, -0.940, -0.933, -0.926, -0.918, -0.910, -0.901, -0.893, -0.883, -0.874, -0.864, //
		-0.854, -0.843, -0.832, -0.821, -0.809, -0.798, -0.785, -0.773, -0.760, -0.747, -0.733, -0.720, -0.706, -0.691, -0.677, //
		-0.662, -0.647, -0.631, -0.616, -0.600, -0.584, -0.567, -0.551, -0.534, -0.517, -0.500, -0.482, -0.465, -0.447, -0.429, //
		-0.411, -0.392, -0.374, -0.355, -0.336, -0.318, -0.299, -0.279, -0.260, -0.241, -0.221, -0.202, -0.182, -0.162, -0.143, //
		-0.123, -0.103, -0.083, -0.063, -0.043, -0.023, -0.003																	//
};

void debug_pthread(void *arg)
{
	uint32_t i = 0;
	while (1)
	{
		float pwm_value = sin_table[i % 315];
		motor_set_value(0, pwm_value);
		motor_set_value(1, -pwm_value);
		k_printf("debug %4.2f\n", pwm_value);
		i++;
		led_blink(1);
		sleep_ticks(100);
	}
}

void debug_task(void)
{
	pcb_create(26, &debug_pthread, NULL, 1024);
}
